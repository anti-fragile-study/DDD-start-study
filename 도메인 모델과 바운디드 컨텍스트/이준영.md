# 도메인 모델과 바운디드 컨텍스트

## 도메인 모델과 경계
하나의 도메인은 여러개의 하위 도메인으로 나뉜다. 예를들어, 이커머스 도메인은 상품, 인증, 주문, 결제 ... 도메인으로 나뉠 수 있다.    
이때, 이 하위도메인을 서로 구분짓지 않고 개발을 하게 되면, 하위 도메인별로 다르게 발전하는 요구사항을 반영하기 어려워진다. _(엮여있는 다른 도메인을 수정해야할수도있고 코드가 거대해지면서 복잡도가 올라가기 때문이다.)_   
   
그래서 이런 하위 도메인을 경계로 나누게 되는데 이때 구분되는 경계를 **바운디드 컨텍스트** 라고 한다.

## 바운디드 컨텍스트
하나의 바운디드 컨텍스트는 하나의 하위 도메인 모델 _(서로 다른 비즈니스 책임을 갖고있고 다른 방향으로 발전해야하는것을 도메인 모델이라고 이해했다.)_ 과 일대일로 매칭되는게 가장 이상적이다.   
하지만, 역할을 명확히 구분하지 못할때 여러개의 모델이 하나의 바운디드 컨텍스트에 엮이게 되는 상황이 있다. 이때 주의할점은 패키지등을 이용해서 물리적으로 분리를 하는 노력을 통해서 하위 도메인 모델이 서로 섞이지 않도록 해야한다.    
또한, 같은 데이터라 하더라도 바운디드 컨텍스트에 따라서 서로 다른 의미를 갖고 있을 수 있다. _(주문 바운디드 컨텍스트에서 상품의 의미와 상점 바운디드 컨텍스트에서 상품이 갖는 의미와 역할은 다르다.)_   

## 바운디드 컨텍스트 구현
하나의 간단한 구조의 바운디드 컨텍스트는 다음 구조로 이루어져 있다.    
단, 이때 팀의 상황과 구현방식에 따라서 서로 다른 바운디드 컨텍스트가 같은 (물리) 데이터베이스를 사용하고 있을 수 있다. 혹은 아래 그림처럼 서로 다른 (물리) 데이터베이스를 사용하는 구조로 발전되어 있을 수 있다.
``` mermaid
flowchart LR

p(표현영역) --> s(응용서비스)
s --> d(도메인)
i(인프라스트럭처) --> d(도메인)
i --> db(데이터베이스)

```
바운디드 컨텍스트간의 통신에는 여러가지 방식이 사용될 수 있는데 예를들어, 표현영역이 다른 바운디드 컨텍스트의 요청을 받는 창구의 역할을 할수도 있고 UI단에서 서로 다른 바운디드 컨텍스트를 연결하고 있을 수 있다.    
구현방식보다 중요한것은 바운디드 컨텍스트간의 논리적, 물리적 분리이며 이러한 분리를 통해서 애플리케이션의 결합도를 낮춰 빠른 배포와 유지보수성의 증대를 얻는것이다.

## 바운디드 컨텍스트간 통합
기존의 도메인에 기능을 추가한다던지 하는 과정을 통해 하위 바운디드 컨텍스트가 생길 수 있다. 이때, 두개의 바운디드 컨텍스트를 분리된 상태를 유지하면서 통합하는 방법이 있는데, 바로 서로 다른 도메인간 연결을 해주는 도메인 서비스를 사용하는것이다. 이때, 도메인 서비스는 성격에 따라 도메인 레이어에 위치할 수 있지만, 이 경우에는 서로 다른 인프라를 통합하는것이므로 구현채를 인프라 영역에 생성한다.   
도메인 서비스를 사용하는 응용서비스는 도메인 서비스에서 받아온 정보를 토대로 자신의 바운디드 컨텍스트에 있는 도메인을 조작하거나, 일련의 시퀀스를 처리한다. 또한, 도메인 서비스로 받아온 데이터가 자신이 관리하는 도메인과 다를 수 있는데 그럴때는 자신의 데이터 타입에 맞게 정보를 가공해야한다.

## 바운디드 컨텍스트 간 관계와 컨텍스트 맵
바운디드 컨텍스트는 관계에 따라서 공급자는 상류, 수용자는 하류로 나뉘게 된다. 이때, 상류 바운디드 컨텍스트의 API를 하류 바운디드 컨텍스트가 받아서 사용하게 되는데, 하류측 구현에 따라서, 공유커널, 독립 방식으로 나뉘게 된다. 각각 방식의 의미는 다음과 같다.

- 공유 커널 : 모든 바운디드 컨텍스트가 하나의 인터페이스를 공유한다.
- 독립 방식 : 클라이언트측에서 바운디드 컨텍스트를 통합한다.
