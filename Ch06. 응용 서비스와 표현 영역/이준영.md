# 표현 영역과 응용 영역

## 응용 서비스의 역할
응용 서비스는 사용자가 요청한 기능을 실행한다. 
이때, 플로우는 아래와 같으며, 만약 응용 서비스가 복잡하다면 도메인 로직의 일부가 응용 서비스에 구현되어 있을 수 있으니 주의해야한다.

```
1. 리포지터리에서 애그리거트를 구한다.
2. 애그리거트의 도메인 기능을 실행한다.
3. 결과를 리턴한다.
```
   
또한, 응용서비스는 트랜잭션의 책임도 갖고있다. 애그리거트 다수를 수정해야하는 서비스를 생각해보면, 트랜잭션을 열지않고 서비스 플로우를 타면 데이터 일관성이 깨질 위험이 있다.   
도메인 로직이 응용서비스로 분산되면, 아래와 같은 이유 때문에 코드 품질에 안좋은 영향을 줄 수 있다.   
1. 코드 응집성이 떨어진다. 즉, 도메인 로직을 파악하기 위해 여러 영역을 분석해야 한다.
2. 코드 중복이 발생한다. 여러 서비스에서 동일한 로직을 구현할경우, 정책이 달라졌을때 함께 수정되지 않을 수 있다.
   
## 응용 서비스의 구현

### 서비스 하나에 vs 서비스 분리
   
서비스를 하나에 두면 공통되는 로직을 재사용할 수 있다는 장점이 있다. 하지만, 서비스 갯수가 많아졌을때 관련없는 메소드들이 하나의 서비스 클래스에 들어가면서 잘못된 변경에 영향을 받을 수 있어서 주의해야한다.   
서비스를 분리하면 클래스의 갯수는 많아지지만 위와 같은 문제를 피할 수 있다는 장점이 있다.

### 인터페이스의 필요 유무

인터페이스가 필요한 상황은 구현 클래스가 여러 개인 경우임. 구현 클래스가 다수 존재하거나 런타임에 구현 객체를 교체해야 할 때 인터페이스를 사용할 수 있는데 이러한 이유가 아니면 전체적인 구조를 복잡하게 할뿐이다.   
**_하지만, 책에서 무조건 이렇게 하라고 제시하는것은 아니며, TDD를 즐겨하면서 표현 영역부터 개발을 시작한다면, 테스트를 위해 인터페이스를 사용하는 경우도 있다고 함. 추가로 나는 인터페이스를 정의하는것을 선호하는데, 인터페이스를 유즈케이스의 입장에서 보기 때문임. 복잡한 구현 클래스로 가지 않고 인터페이스만을 통해서 도메인에 어떤 사용법이 있는지 확인할 수 있다는것 만으로 생산성에 큰 향상을 준다고 생각함._**

### 애그리거트를 반환해도 되는가?

코딩은 빠르겠지만, 표현영역에서 애그리거트를 사용할 수 있음. 이는 코드 응집도를 낮추게 하고 결국 유지보수하기 힘들어질 수 있으니 주의해야한다.

## 표현 영역

표현영역은 다음 역할을 한다.   
- 사용자에게 화면을 보여준다.   
- 사용자의 요청에 알맞은 응답을 리턴함.   
- 사용자의 세션을 관리한다.   
- 사용자의 요청을 응용서비스가 필요로하는 객체로 변환한다.   

## 값 검증

필자는 옛날에는 논리적인 로직은 응용 서비스, 필수값은 표현 영역 에서 하는것도 괜찮다고 생각하나 최근에는 응용 서비스의 완성도가 높아진다는 이점 때문에, 응용 서비스에서 값 검증을 한다고 한다.   
_나는 약간 다른 생각을 갖고있는데, 네트워크를 타는 통신을 해야할때 트랜잭션 범위 밖에서 수행하기 위해 응용 서비스에 도달하기 전에 다른곳의 데이터를 끌고 오는 경우가 종종 있었다. 만약, 이때 표현 영역에서 값 검증을 미리 했다면 비싸고 불필요한 네트워크 통신을 줄일 수 있을것이다. 하지만, 응용서비스에서 값 검증을 한다면 네트워크 통신을 부담하는 동시에 응용서비스의 Valid fail 로 로직은 반드시 실패한다._
